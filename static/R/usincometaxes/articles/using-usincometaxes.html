<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="usincometaxes">
<title>Calculating Federal and State Income Taxes • usincometaxes</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculating Federal and State Income Taxes">
<meta property="og:description" content="usincometaxes">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">usincometaxes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/using-usincometaxes.html">Calculating Federal and State Income Taxes</a>
    <a class="dropdown-item" href="../articles/taxsim-input.html">Description of Input Columns</a>
    <a class="dropdown-item" href="../articles/taxsim-output.html">Description of Output Columns</a>
    <a class="dropdown-item" href="../articles/send-data-to-taxsim.html">Manually Upload Data to TAXSIM 35</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/shanejorr/usincometaxes/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">

<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Calculating Federal and State Income Taxes</h1>
                        <h4 data-toc-skip class="author">Shane Orr</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/shanejorr/usincometaxes/blob/HEAD/vignettes/using-usincometaxes.Rmd" class="external-link"><code>vignettes/using-usincometaxes.Rmd</code></a></small>
      <div class="d-none name"><code>using-usincometaxes.Rmd</code></div>
    </div>

    
    
<p>This article presents two use cases for <code>usincometaxes</code>. The first shows users how to estimate income taxes from a data frame containing financial information and other characteristics of tax payer units. This income could come from surveys such as the <a href="https://www.bls.gov/cex/" class="external-link">Consumer Expenditure survey</a> or the <a href="https://psidonline.isr.umich.edu/" class="external-link">Panel Study of Income Dynamics survey</a>. The second use case focuses on running simulations.</p>
<div class="section level2">
<h2 id="calculating-income-taxes-from-survey-data">Calculating income taxes from survey data<a class="anchor" aria-label="anchor" href="#calculating-income-taxes-from-survey-data"></a>
</h2>
<p>For the first example we will use an internal data set called <code>taxpayer_finances</code>. The data is randomly generated and formatted for use with <code>usincometaxes</code>. Guidance on formatting data can be found in the <a href="taxsim-input.html">Description of Input Columns</a> article.</p>
<p>The data set contains financial and other household characteristics that help estimate income taxes.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">taxpayer_finances</span><span class="op">)</span>

<span class="va">taxpayer_finances</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="7%">
<col width="4%">
<col width="14%">
<col width="4%">
<col width="4%">
<col width="4%">
<col width="4%">
<col width="4%">
<col width="4%">
<col width="4%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="6%">
<col width="6%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="right">taxsimid</th>
<th align="right">year</th>
<th align="left">mstat</th>
<th align="left">state</th>
<th align="right">page</th>
<th align="right">sage</th>
<th align="right">depx</th>
<th align="right">age1</th>
<th align="right">age2</th>
<th align="right">age3</th>
<th align="right">pwages</th>
<th align="right">swages</th>
<th align="right">dividends</th>
<th align="right">intrec</th>
<th align="right">stcg</th>
<th align="right">ltcg</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">2000</td>
<td align="left">single</td>
<td align="left">NC</td>
<td align="right">37</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">6</td>
<td align="right">7</td>
<td align="right">8</td>
<td align="right">26361.75</td>
<td align="right">0.00</td>
<td align="right">2260.86</td>
<td align="right">4340.19</td>
<td align="right">2280.16</td>
<td align="right">2060.29</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2000</td>
<td align="left">single</td>
<td align="left">NC</td>
<td align="right">29</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">7</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">33966.34</td>
<td align="right">0.00</td>
<td align="right">1969.54</td>
<td align="right">868.10</td>
<td align="right">1064.50</td>
<td align="right">2234.61</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">2000</td>
<td align="left">married, jointly</td>
<td align="left">NC</td>
<td align="right">36</td>
<td align="right">30</td>
<td align="right">1</td>
<td align="right">13</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">174191.53</td>
<td align="right">102286.98</td>
<td align="right">1972.47</td>
<td align="right">2048.31</td>
<td align="right">1009.11</td>
<td align="right">1226.34</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">2000</td>
<td align="left">married, jointly</td>
<td align="left">NC</td>
<td align="right">37</td>
<td align="right">34</td>
<td align="right">3</td>
<td align="right">5</td>
<td align="right">6</td>
<td align="right">7</td>
<td align="right">67604.57</td>
<td align="right">53205.76</td>
<td align="right">1173.95</td>
<td align="right">881.67</td>
<td align="right">3582.74</td>
<td align="right">1405.74</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">2000</td>
<td align="left">married, jointly</td>
<td align="left">NC</td>
<td align="right">38</td>
<td align="right">39</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">21176.78</td>
<td align="right">21687.72</td>
<td align="right">4614.91</td>
<td align="right">1588.52</td>
<td align="right">560.93</td>
<td align="right">825.04</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">2000</td>
<td align="left">single</td>
<td align="left">NC</td>
<td align="right">36</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">53397.72</td>
<td align="right">0.00</td>
<td align="right">2067.41</td>
<td align="right">1320.01</td>
<td align="right">687.23</td>
<td align="right">3548.07</td>
</tr>
</tbody>
</table>
<p>Each row in the data set is a tax paying unit. Thus, each row files one tax return. Columns represent items reported on tax returns that impact taxes. Of course, the information in the data set does not represent everything people report on tax returns. For this reason, the income tax calculations are simply estimates.</p>
<p>We call <code><a href="../reference/taxsim_calculate_taxes.html">taxsim_calculate_taxes()</a></code> to estimate federal and state income taxes for each tax paying unit. <code><a href="../reference/taxsim_calculate_taxes.html">taxsim_calculate_taxes()</a></code> sends the data to the <a href="https://users.nber.org/~taxsim/taxsim35/" class="external-link">NBER’s TAXSIM 35</a> program for calculation and returns the results as a data frame.</p>
<p>We are only interested in federal and state tax liabilities, not line item credits and deduction, so we are using <code>return_all_information = FALSE</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">family_taxes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/taxsim_calculate_taxes.html">taxsim_calculate_taxes</a></span><span class="op">(</span>
  .data <span class="op">=</span> <span class="va">taxpayer_finances</span>,
  return_all_information <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>

<span class="va">family_taxes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">taxsimid</th>
<th align="right">fiitax</th>
<th align="right">siitax</th>
<th align="right">fica</th>
<th align="right">frate</th>
<th align="right">srate</th>
<th align="right">ficar</th>
<th align="right">tfica</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">924.97</td>
<td align="right">1046.23</td>
<td align="right">4033.35</td>
<td align="right">15.00</td>
<td align="right">7.00</td>
<td align="right">15.3</td>
<td align="right">2016.67</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">3596.23</td>
<td align="right">1947.22</td>
<td align="right">5196.85</td>
<td align="right">15.00</td>
<td align="right">7.00</td>
<td align="right">15.3</td>
<td align="right">2598.42</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">78080.32</td>
<td align="right">20429.27</td>
<td align="right">26915.48</td>
<td align="right">36.58</td>
<td align="right">8.12</td>
<td align="right">2.9</td>
<td align="right">13457.74</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">23279.56</td>
<td align="right">7783.72</td>
<td align="right">18483.98</td>
<td align="right">30.83</td>
<td align="right">7.75</td>
<td align="right">15.3</td>
<td align="right">9241.99</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">5584.33</td>
<td align="right">2619.27</td>
<td align="right">6558.27</td>
<td align="right">15.00</td>
<td align="right">7.00</td>
<td align="right">15.3</td>
<td align="right">3279.13</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">8358.38</td>
<td align="right">3411.43</td>
<td align="right">8169.85</td>
<td align="right">28.00</td>
<td align="right">7.00</td>
<td align="right">15.3</td>
<td align="right">4084.93</td>
</tr>
</tbody>
</table>
<p>The <code>taxsimid</code> column is required for any input data frame used in <code>taxsim_calculate_taxes</code>. This column is also returned in the output data frame containing tax calculations, allowing us to link the input and output data frames.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">income_and_taxes</span> <span class="op">&lt;-</span> <span class="va">taxpayer_finances</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">family_taxes</span>, by <span class="op">=</span> <span class="st">'taxsimid'</span><span class="op">)</span>

<span class="va">income_and_taxes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="5%">
<col width="2%">
<col width="9%">
<col width="3%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="4%">
<col width="4%">
<col width="4%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="right">taxsimid</th>
<th align="right">year</th>
<th align="left">mstat</th>
<th align="left">state</th>
<th align="right">page</th>
<th align="right">sage</th>
<th align="right">depx</th>
<th align="right">age1</th>
<th align="right">age2</th>
<th align="right">age3</th>
<th align="right">pwages</th>
<th align="right">swages</th>
<th align="right">dividends</th>
<th align="right">intrec</th>
<th align="right">stcg</th>
<th align="right">ltcg</th>
<th align="right">fiitax</th>
<th align="right">siitax</th>
<th align="right">fica</th>
<th align="right">frate</th>
<th align="right">srate</th>
<th align="right">ficar</th>
<th align="right">tfica</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">2000</td>
<td align="left">single</td>
<td align="left">NC</td>
<td align="right">37</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">6</td>
<td align="right">7</td>
<td align="right">8</td>
<td align="right">26361.75</td>
<td align="right">0.00</td>
<td align="right">2260.86</td>
<td align="right">4340.19</td>
<td align="right">2280.16</td>
<td align="right">2060.29</td>
<td align="right">924.97</td>
<td align="right">1046.23</td>
<td align="right">4033.35</td>
<td align="right">15.00</td>
<td align="right">7.00</td>
<td align="right">15.3</td>
<td align="right">2016.67</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2000</td>
<td align="left">single</td>
<td align="left">NC</td>
<td align="right">29</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">7</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">33966.34</td>
<td align="right">0.00</td>
<td align="right">1969.54</td>
<td align="right">868.10</td>
<td align="right">1064.50</td>
<td align="right">2234.61</td>
<td align="right">3596.23</td>
<td align="right">1947.22</td>
<td align="right">5196.85</td>
<td align="right">15.00</td>
<td align="right">7.00</td>
<td align="right">15.3</td>
<td align="right">2598.42</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">2000</td>
<td align="left">married, jointly</td>
<td align="left">NC</td>
<td align="right">36</td>
<td align="right">30</td>
<td align="right">1</td>
<td align="right">13</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">174191.53</td>
<td align="right">102286.98</td>
<td align="right">1972.47</td>
<td align="right">2048.31</td>
<td align="right">1009.11</td>
<td align="right">1226.34</td>
<td align="right">78080.32</td>
<td align="right">20429.27</td>
<td align="right">26915.48</td>
<td align="right">36.58</td>
<td align="right">8.12</td>
<td align="right">2.9</td>
<td align="right">13457.74</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">2000</td>
<td align="left">married, jointly</td>
<td align="left">NC</td>
<td align="right">37</td>
<td align="right">34</td>
<td align="right">3</td>
<td align="right">5</td>
<td align="right">6</td>
<td align="right">7</td>
<td align="right">67604.57</td>
<td align="right">53205.76</td>
<td align="right">1173.95</td>
<td align="right">881.67</td>
<td align="right">3582.74</td>
<td align="right">1405.74</td>
<td align="right">23279.56</td>
<td align="right">7783.72</td>
<td align="right">18483.98</td>
<td align="right">30.83</td>
<td align="right">7.75</td>
<td align="right">15.3</td>
<td align="right">9241.99</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">2000</td>
<td align="left">married, jointly</td>
<td align="left">NC</td>
<td align="right">38</td>
<td align="right">39</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">21176.78</td>
<td align="right">21687.72</td>
<td align="right">4614.91</td>
<td align="right">1588.52</td>
<td align="right">560.93</td>
<td align="right">825.04</td>
<td align="right">5584.33</td>
<td align="right">2619.27</td>
<td align="right">6558.27</td>
<td align="right">15.00</td>
<td align="right">7.00</td>
<td align="right">15.3</td>
<td align="right">3279.13</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">2000</td>
<td align="left">single</td>
<td align="left">NC</td>
<td align="right">36</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">53397.72</td>
<td align="right">0.00</td>
<td align="right">2067.41</td>
<td align="right">1320.01</td>
<td align="right">687.23</td>
<td align="right">3548.07</td>
<td align="right">8358.38</td>
<td align="right">3411.43</td>
<td align="right">8169.85</td>
<td align="right">28.00</td>
<td align="right">7.00</td>
<td align="right">15.3</td>
<td align="right">4084.93</td>
</tr>
</tbody>
</table>
<p>Now we have a single data frame containing both wages and income tax liabilities. Let’s take a look at the relationship between wages and estimated federal income taxes. The colors represent the number of children 18 or younger.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># custom theme for all plots in the vignette</span>
<span class="va">plt_theme</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  
    <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>
      legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>,
      axis.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
      axis.title<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">11</span>,face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,
      strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>,
      panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
      plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
      plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,
      legend.position <span class="op">=</span> <span class="st">'bottom'</span>
    <span class="op">)</span>
<span class="op">}</span>
<span class="co"># color palettes for number of children</span>
<span class="va">dep_color_palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'#4B0055'</span>,<span class="st">'#353E7C'</span>,<span class="st">'#007094'</span>,<span class="st">'#009B95'</span>,<span class="st">'#00BE7D'</span>,<span class="st">'#96D84B'</span><span class="op">)</span><span class="op">)</span>

<span class="va">income_and_taxes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    tax_unit_income <span class="op">=</span> <span class="va">pwages</span> <span class="op">+</span> <span class="va">swages</span>,
    num_dependents_eitc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">depx</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span>,
    filing_status <span class="op">=</span> <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/toTitleCase.html" class="external-link">toTitleCase</a></span><span class="op">(</span><span class="va">mstat</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">tax_unit_income</span>, <span class="va">fiitax</span>, color <span class="op">=</span> <span class="va">num_dependents_eitc</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_dollar.html" class="external-link">label_dollar</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">.001</span>, suffix <span class="op">=</span> <span class="st">"K"</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">200000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_dollar.html" class="external-link">label_dollar</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">.001</span>, suffix <span class="op">=</span> <span class="st">"K"</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10000</span>, <span class="fl">50000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_color_discrete</span><span class="op">(</span>type <span class="op">=</span> <span class="va">dep_color_palette</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">facet_grid</span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">mstat</span><span class="op">)</span>, cols <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>
      title <span class="op">=</span> <span class="st">"Federal Income Taxes by Filing Status, Year, and Number of Children"</span>,
      x <span class="op">=</span> <span class="st">"\nHousehold Wages"</span>,
      y <span class="op">=</span> <span class="st">"Federal Income Taxes"</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu">plt_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">guides</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Number of Childern 18 or Younger"</span>, title.position <span class="op">=</span> <span class="st">"top"</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 134 rows containing missing values (geom_point).</span></code></pre></div>
<p><img src="webimg/plot_family_taxes-1.png" width="648" style="display: block; margin: auto;"></p>
<p>The plots shows what we would expect: higher income families pay more in taxes and households pay less the more children they have. We also see the reduction in federal marginal tax rates from 2000 to 2020, as shown by the decrease in income tax liabilities when comparing the two years.</p>
</div>
<div class="section level2">
<h2 id="income-tax-simulations">Income tax simulations<a class="anchor" aria-label="anchor" href="#income-tax-simulations"></a>
</h2>
<div class="section level3">
<h3 id="association-between-income-taxes-paid-and-household-wages">Association between income taxes paid and household wages<a class="anchor" aria-label="anchor" href="#association-between-income-taxes-paid-and-household-wages"></a>
</h3>
<p>An additional use of <code>usincometaxes</code> is to run simulations. This could be as simple as plotting the relationship between wages and income taxes paid. To do this, we first need to create a data set that holds everything constant except for wages. The code block below does this, except it also creates different data sets for households with zero and four children 18 or younger, so we can compare differences on this characteristic as well.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># calculate taxes from 0 to 200,000 in wages</span>
<span class="va">wage_linespace</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">200000</span>, <span class="fl">100</span><span class="op">)</span>

<span class="va">n_kids</span> <span class="op">&lt;-</span> <span class="fl">4</span>

<span class="va">base_family_income</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>
  year <span class="op">=</span> <span class="fl">2020</span>,
  mstat <span class="op">=</span> <span class="st">'married, jointly'</span>,
  state <span class="op">=</span> <span class="st">'NC'</span>,
  page <span class="op">=</span> <span class="fl">40</span>,
  sage <span class="op">=</span> <span class="fl">40</span>,
  depx <span class="op">=</span> <span class="va">n_kids</span>,
  age1 <span class="op">=</span> <span class="va">n_kids</span>,
  age2 <span class="op">=</span> <span class="va">n_kids</span>,
  age3 <span class="op">=</span> <span class="va">n_kids</span>,
  pwages <span class="op">=</span> <span class="va">wage_linespace</span>,
  swages <span class="op">=</span> <span class="fl">0</span>
<span class="op">)</span>

<span class="co"># create an additional data set with no dependents and add it to the original</span>
<span class="va">family_income</span> <span class="op">&lt;-</span> <span class="va">base_family_income</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span>
    <span class="co"># make all numeber of dependent columns 0</span>
    <span class="va">base_family_income</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">depx</span>, <span class="va">age1</span>, <span class="va">age2</span>, <span class="va">age3</span><span class="op">)</span>, <span class="op">~</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="co"># add unique ID to each row</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>taxsimid <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">taxsimid</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">family_income</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">taxsimid</th>
<th align="right">year</th>
<th align="left">mstat</th>
<th align="left">state</th>
<th align="right">page</th>
<th align="right">sage</th>
<th align="right">depx</th>
<th align="right">age1</th>
<th align="right">age2</th>
<th align="right">age3</th>
<th align="right">pwages</th>
<th align="right">swages</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">2020</td>
<td align="left">married, jointly</td>
<td align="left">NC</td>
<td align="right">40</td>
<td align="right">40</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2020</td>
<td align="left">married, jointly</td>
<td align="left">NC</td>
<td align="right">40</td>
<td align="right">40</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">100</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">2020</td>
<td align="left">married, jointly</td>
<td align="left">NC</td>
<td align="right">40</td>
<td align="right">40</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">200</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">2020</td>
<td align="left">married, jointly</td>
<td align="left">NC</td>
<td align="right">40</td>
<td align="right">40</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">300</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">2020</td>
<td align="left">married, jointly</td>
<td align="left">NC</td>
<td align="right">40</td>
<td align="right">40</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">400</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">2020</td>
<td align="left">married, jointly</td>
<td align="left">NC</td>
<td align="right">40</td>
<td align="right">40</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">500</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>Now, we will calculate federal and state income taxes for our simulated data set. Note that <code>return_all_information = TRUE</code>. This allows us to examine credit amounts like the Child Tax Credit and Earned Income Tax Credit (EITC).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">family_income_taxes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/taxsim_calculate_taxes.html">taxsim_calculate_taxes</a></span><span class="op">(</span>
  .data <span class="op">=</span> <span class="va">family_income</span>,
  return_all_information <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="va">family_income_taxes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="1%">
<col width="0%">
<col width="0%">
<col width="0%">
<col width="0%">
<col width="0%">
<col width="0%">
<col width="0%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="3%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="3%">
<col width="3%">
<col width="2%">
<col width="1%">
<col width="1%">
<col width="2%">
<col width="3%">
<col width="1%">
<col width="3%">
<col width="2%">
<col width="1%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="2%">
<col width="3%">
<col width="3%">
<col width="1%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="3%">
<col width="3%">
<col width="2%">
</colgroup>
<thead><tr class="header">
<th align="right">taxsimid</th>
<th align="right">fiitax</th>
<th align="right">siitax</th>
<th align="right">fica</th>
<th align="right">frate</th>
<th align="right">srate</th>
<th align="right">ficar</th>
<th align="right">tfica</th>
<th align="right">v10_federal_agi</th>
<th align="right">v11_ui_agi</th>
<th align="right">v12_soc_sec_agi</th>
<th align="right">v13_zero_bracket_amount</th>
<th align="right">v14_personal_exemptions</th>
<th align="right">v15_exemption_phaseout</th>
<th align="right">v16_deduction_phaseout</th>
<th align="right">v17_itemized_deductions</th>
<th align="right">v18_federal_taxable_income</th>
<th align="right">v19_tax_on_taxable_income</th>
<th align="right">v20_exemption_surtax</th>
<th align="right">v21_general_tax_credit</th>
<th align="right">v22_child_tax_credit_adjusted</th>
<th align="right">v23_child_tax_credit_refundable</th>
<th align="right">v24_child_care_credit</th>
<th align="right">v25_eitc</th>
<th align="right">v26_amt_income</th>
<th align="right">v27_amt_liability</th>
<th align="right">v28_fed_income_tax_before_credit</th>
<th align="right">v29_fica</th>
<th align="right">v30_state_household_income</th>
<th align="right">v31_state_rent_expense</th>
<th align="right">v32_state_agi</th>
<th align="right">v33_state_exemption_amount</th>
<th align="right">v34_state_std_deduction_amount</th>
<th align="right">v35_state_itemized_deducation</th>
<th align="right">v36_state_taxable_income</th>
<th align="right">v37_state_property_tax_credit</th>
<th align="right">v38_state_child_care_credit</th>
<th align="right">v39_state_eitc</th>
<th align="right">v40_state_total_credits</th>
<th align="right">v41_state_bracket_rate</th>
<th align="right">v42_self_emp_income</th>
<th align="right">v43_medicare_tax_unearned_income</th>
<th align="right">v44_medicare_tax_earned_income</th>
<th align="right">v45_cares_recovery_rebate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">-6900</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">-45</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">0.00</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">24800</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">0.01</td>
<td align="right">0</td>
<td align="right">0.01</td>
<td align="right">0</td>
<td align="right">21500</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">6900</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">-6945</td>
<td align="right">0</td>
<td align="right">15.3</td>
<td align="right">-45</td>
<td align="right">0</td>
<td align="right">15.3</td>
<td align="right">7.65</td>
<td align="right">100</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">24800</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">45</td>
<td align="right">100</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">15.3</td>
<td align="right">101.01</td>
<td align="right">0</td>
<td align="right">100.01</td>
<td align="right">0</td>
<td align="right">21500</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">100</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">6900</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">-6990</td>
<td align="right">0</td>
<td align="right">30.6</td>
<td align="right">-45</td>
<td align="right">0</td>
<td align="right">15.3</td>
<td align="right">15.30</td>
<td align="right">200</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">24800</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">90</td>
<td align="right">200</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">30.6</td>
<td align="right">201.01</td>
<td align="right">0</td>
<td align="right">200.01</td>
<td align="right">0</td>
<td align="right">21500</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">200</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">6900</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">-7035</td>
<td align="right">0</td>
<td align="right">45.9</td>
<td align="right">-45</td>
<td align="right">0</td>
<td align="right">15.3</td>
<td align="right">22.95</td>
<td align="right">300</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">24800</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">135</td>
<td align="right">300</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">45.9</td>
<td align="right">301.01</td>
<td align="right">0</td>
<td align="right">300.01</td>
<td align="right">0</td>
<td align="right">21500</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">300</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">6900</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">-7080</td>
<td align="right">0</td>
<td align="right">61.2</td>
<td align="right">-45</td>
<td align="right">0</td>
<td align="right">15.3</td>
<td align="right">30.60</td>
<td align="right">400</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">24800</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">180</td>
<td align="right">400</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">61.2</td>
<td align="right">401.01</td>
<td align="right">0</td>
<td align="right">400.01</td>
<td align="right">0</td>
<td align="right">21500</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">400</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">6900</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">-7125</td>
<td align="right">0</td>
<td align="right">76.5</td>
<td align="right">-45</td>
<td align="right">0</td>
<td align="right">15.3</td>
<td align="right">38.25</td>
<td align="right">500</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">24800</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">225</td>
<td align="right">500</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">76.5</td>
<td align="right">501.01</td>
<td align="right">0</td>
<td align="right">500.01</td>
<td align="right">0</td>
<td align="right">21500</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">500</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">6900</td>
</tr>
</tbody>
</table>
<p>As before, let’s merge our tax data with the original input data set.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">family_income</span> <span class="op">&lt;-</span> <span class="va">family_income</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">family_income_taxes</span>, by <span class="op">=</span> <span class="st">'taxsimid'</span><span class="op">)</span></code></pre></div>
<p>Now, let’s look at the relationship between household wages and estimated income tax liabilities.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">family_income_long</span> <span class="op">&lt;-</span> <span class="va">family_income</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">pwages</span>, <span class="va">depx</span>, <span class="va">fiitax</span>, <span class="va">siitax</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'fiitax'</span>, <span class="st">'siitax'</span><span class="op">)</span>, 
               names_to <span class="op">=</span> <span class="st">'jurisdiction'</span>, values_to <span class="op">=</span> <span class="st">'taxes_paid'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    jurisdiction <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">jurisdiction</span>, <span class="st">'fiitax'</span> <span class="op">=</span> <span class="st">'Federal Income Taxes'</span>, <span class="st">'siitax'</span> <span class="op">=</span> <span class="st">'NC State Income Taxes'</span><span class="op">)</span>,
    num_dependents_eitc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">depx</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span>,
    post_tax_wages <span class="op">=</span> <span class="va">pwages</span> <span class="op">-</span> <span class="va">taxes_paid</span>
  <span class="op">)</span>
<span class="co"># primary_wages, taxes_paid, color = as.character(num_dependents_eitc)</span>
<span class="va">taxes_line_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.data</span>, <span class="va">x_var</span>, <span class="va">y_var</span>, <span class="va">color_var</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="va">.data</span>, <span class="fu">aes</span><span class="op">(</span><span class="op">{</span><span class="op">{</span><span class="va">x_var</span><span class="op">}</span><span class="op">}</span>, <span class="op">{</span><span class="op">{</span><span class="va">y_var</span><span class="op">}</span><span class="op">}</span>, color <span class="op">=</span> <span class="op">{</span><span class="op">{</span><span class="va">color_var</span><span class="op">}</span><span class="op">}</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_line</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_dollar.html" class="external-link">label_dollar</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">.001</span>, suffix <span class="op">=</span> <span class="st">"K"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_dollar.html" class="external-link">label_dollar</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">.001</span>, suffix <span class="op">=</span> <span class="st">"K"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_color_brewer</span><span class="op">(</span>type <span class="op">=</span> <span class="st">'seq'</span>, palette <span class="op">=</span> <span class="st">'Set2'</span><span class="op">)</span>  <span class="op">+</span>
    <span class="fu">plt_theme</span><span class="op">(</span><span class="op">)</span>
  
<span class="op">}</span>
<span class="fu">taxes_line_plot</span><span class="op">(</span><span class="va">family_income_long</span>, <span class="va">pwages</span>, <span class="va">taxes_paid</span>, <span class="va">num_dependents_eitc</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">jurisdiction</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Relationship Between Wages and Income Taxes Paid"</span>,
    subtitle <span class="op">=</span> <span class="st">"Taxpayer is married, filing jointly, in 2020"</span>,
    x <span class="op">=</span> <span class="st">"\nPre-Tax Household Wages"</span>,
    y <span class="op">=</span> <span class="st">"Federal Income Taxes"</span>,
    color <span class="op">=</span> <span class="st">'Number of Children 18 or Younger:'</span>
  <span class="op">)</span></code></pre></div>
<p><img src="webimg/unnamed-chunk-5-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Note that North Carolina had a flat tax of 5.25% in 2020. That’s why their taxes increase linearly.</p>
</div>
<div class="section level3">
<h3 id="relationship-between-pre-and-post-tax-wages">Relationship Between Pre and Post-Tax Wages<a class="anchor" aria-label="anchor" href="#relationship-between-pre-and-post-tax-wages"></a>
</h3>
<p>We’ll create a additional plot comparing pre-tax and post-tax household wages.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">taxes_line_plot</span><span class="op">(</span><span class="va">family_income_long</span>, <span class="va">pwages</span>, <span class="va">post_tax_wages</span>, <span class="va">num_dependents_eitc</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">jurisdiction</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Relationship Between Pre and Post-Tax Wages"</span>,
    subtitle <span class="op">=</span> <span class="st">"Taxpayer is married, filing jointly, in 2020"</span>,
    x <span class="op">=</span> <span class="st">"\nPre-Tax Household Wages"</span>,
    y <span class="op">=</span> <span class="st">"Post-Tax Hosuehold Wages"</span>,
    color <span class="op">=</span> <span class="st">'Number of Children 18 or Younger:'</span>
  <span class="op">)</span></code></pre></div>
<p><img src="webimg/unnamed-chunk-6-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="child-tax-credit-and-earned-income-tax-credit-eitc">Child Tax Credit and Earned Income Tax Credit (EITC)<a class="anchor" aria-label="anchor" href="#child-tax-credit-and-earned-income-tax-credit-eitc"></a>
</h3>
<p>As noted previously, setting <code>return_all_information = TRUE</code> lets us retrieve additional output. Included in this additional output are amounts for the Child Tax Credit and EITC. Let’s look at the amounts for both credits, while varying household wages. The values reflect a household with four children 18 or younger.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tax_items_mapping</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
  v25_eitc <span class="op">=</span> <span class="st">'Earned Income Tax Credit'</span>,
  child_tax_credit <span class="op">=</span> <span class="st">'Child Tax Credit'</span>
<span class="op">)</span>

<span class="va">family_income</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">depx</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>child_tax_credit <span class="op">=</span> <span class="va">v22_child_tax_credit_adjusted</span> <span class="op">+</span> <span class="va">v23_child_tax_credit_refundable</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">pwages</span>, <span class="va">fiitax</span>, <span class="va">v25_eitc</span>, <span class="va">child_tax_credit</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tax_items_mapping</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">'tax_item'</span>, values_to <span class="op">=</span> <span class="st">'amount'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>tax_item <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">tax_item</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">tax_items_mapping</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">taxes_line_plot</span><span class="op">(</span><span class="va">pwages</span>, <span class="va">amount</span>, <span class="va">tax_item</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Relationship Between Wages and Credits"</span>,
    subtitle <span class="op">=</span> <span class="st">"Taxpayer is married, filing jointly, in 2020 and has four children under 19"</span>,
    x <span class="op">=</span> <span class="st">"\nPre-Tax Wages"</span>,
    y <span class="op">=</span> <span class="st">"Credit Amount"</span>,
    color <span class="op">=</span> <span class="cn">NULL</span>
  <span class="op">)</span></code></pre></div>
<p><img src="webimg/unnamed-chunk-7-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://shaneorr.io" class="external-link">Shane Orr</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
